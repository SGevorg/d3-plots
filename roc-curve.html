<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans" />
    <style>
      body { font: 12px Arial;}

      path {
        stroke-width: 3;
        fill: none;
      }

      .axis path,
      .axis line {
        fill: none;
        stroke: grey;
        stroke-width: 2;
        shape-rendering: crispEdges;
      }

      .d3-tip {
        font-family: "Open Sans";
        background: rgba(0, 0, 0, 0.8);
        padding: 8px;
        color: #fff;
        z-index: 5070;
      }
    </style>
  </head>
<body>
  <div id="roc"> </div>
  <!-- <svg width="960" height="500"></svg> -->
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.3/lodash.min.js"></script>
  <script>
    var data = [
      {c: 1, s: 0.95},
      {c: 1, s: 0.94},
      {c: 1, s: 0.9},
      {c: 1, s: 0.85},
      {c: 1, s: 0.84},
      {c: 0, s: 0.7},
      {c: 1, s: 0.75},
      {c: 1, s: 0.74},
      {c: 1, s: 0.6},
      {c: 1, s: 0.65},
      {c: 1, s: 0.64},
      {c: 1, s: 0.5},
      {c: 1, s: 0.55},
      {c: 0, s: 0.54},
      {c: 0, s: 0.4},
      {c: 0, s: 0.45},
      {c: 0, s: 0.44},
      {c: 0, s: 0.4},
      {c: 0, s: 0.36},
      {c: 0, s: 0.32},
      {c: 1, s: 0.3},
      {c: 0, s: 0.2},
      {c: 0, s: 0.1},
      {c: 0, s: 0.01},
      {c: 0, s: 0.001},
      {c: 0, s: 0.0001},
      {c: 0, s: 0.000003},
      {c: 0, s: 0.000001}
    ];

    var baseline = [{X: 0, Y: 0}, {X: 1, Y: 1}];

    var graphData = [{X: 0, Y: 0}];
    var posCount = _.reduce(data, function (sum, item) {
      return sum + item.c;
    }, 0);

    var vScale = 1 / posCount;
    var hScale = 1 / (data.length - posCount);
    for (var i = 0; i < data.length; i++) {
      if (data[i].c === 1) {
        graphData.push({X: graphData[i].X, Y: graphData[i].Y + vScale});
      } else {
        graphData.push({X: graphData[i].X + hScale, Y: graphData[i].Y});
      }
    }

    var margin = {top: 40, right: 40, bottom: 40, left: 40};
    var width = 400 - margin.left - margin.right;
    var height = 400 - margin.top - margin.bottom;

    var x = d3.scaleLinear().range([0, width]);
    var y = d3.scaleLinear().range([height, 0]);

    var xAxis = d3.axisBottom().scale(x).ticks(5);
    var yAxis = d3.axisLeft().scale(y).ticks(5);

    var valueline = d3.line()
      .x(function (d) { return x(d.X); })
      .y(function (d) { return y(d.Y); });

    var svg = d3.select('#roc')
      .append('svg')
        .attr('width', width + margin.left + margin.right)
        .attr('height', height + margin.top + margin.bottom)
      .append('g')
        .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

    svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis)
     .append("text")
      .attr("x", width / 2)
      .attr("y", 40 )
      .style("text-anchor", "middle")
      .text("1 - False Negative Rate");

    svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
     .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 0 - margin.left + 10 )
      .attr("x", 0 - height/1.6 )
      .style("font-size","12px")
      .style("text-anchor", "left")
      .text("True Positive Rate");

    x.domain([0, 1]);
    y.domain([0, 1]);

    svg.append('path')
      .attr('class', 'line')
      .attr('stroke', '#cccccc')
      .attr('d', valueline(baseline));

    svg.append('path')
      .attr('class', 'line')
      .attr('stroke', '#c1501b')
      .attr('d', valueline(graphData));

    svg.append('text')
      .attr('y', height / 2 + 60)
      .attr('x', width / 2)
      .style('font-family', 'Open Sans')
      .style('font-weight', 'bold')
      .style('font-size', '14px')
      .text('Area: ' + calculateArea(data, vScale, hScale).toFixed(3));

    function calculateArea(data, vScale, hScale) {
      var area = 0;
      var rectHeight = 0;
      var rectWidth = 0;
      for (var i = 0; i < data.length; i++) {
        if (data[i].c === 1 && rectWidth === 0) {
          rectHeight += vScale;
        } else if (data[i].c === 1 && rectWidth > 0) {
          area += rectHeight * rectWidth;
          rectHeight += vScale;
          rectWidth = 0;
        } else if (data[i].c === 0) {
          rectWidth += hScale;
        }
      }
      area += rectWidth * rectHeight;
      return area;
    }

  </script>
</body>
</html>
